<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>category</title>
<link rel="stylesheet" type="text/css" href="css/reset.css"/>
<link rel="stylesheet" type="text/css" href="css/common.css"/>
<script src="http://code.jquery.com/jquery-3.6.4.min.js"></script>
<style>
	form > span { /* 폼 태그 안의 span 태그를 보이지 않게 설정함. 각 span 안에 드롭다운 출력. */
		display:none;
	}
</style>
<script>
	$(function() { // 1depth의 드롭다운을 기본으로 로드한다.
		$("#category1").load("ajax/text/category-data.html #category1-1", // 첫 번째 셀렉트 옵션 가져와서 span 태그 안에 넣음
				function() { 
			$(this).show(); // 로딩이 완료되면 드롭다운을 감싸는 태그 요소를 화면에 표시한다. 시간을 정하지 않았으므로 애니메이션 없이 바로 보여 줌.
		});
	// 드롭다운이 body 상에 존재하지 않으므로 이벤트는 미리 정의해 놓아야 한다.
		// 1depth가 변경될 경우 발생할 이벤트
		$(document).on("change", "#category1 > select", function() { 
			// 상위 dept가 바뀔 경우 하위 depth는 모두 초기화.
			$("#category2").empty().hide();
			$("#category3").empty().hide();
			// 선택한 항목이 지시하는 하위 카테고리 페이지의 URL 얻기
			var target = $(this).find("option:selected").attr("data-target"); // this = category1에서 발생한 change 이벤트
			var selector = "ajax/text/category-data.html " + target; // target = 카테고리 id
			// 다음 항목 로드
			$("#category2").load(selector, function() {
				$(this).show();
			});
		}); // on 1 end
		// 2depth에 대한 change 이벤트
		$(document).on("change", "#category2 > select", function() {
			$("#category3").empty().hide(); // 2depth가 변경되었으므로 3depth 초기화.
			// 선택한 항목이 지시하는 하위 카테고리 페이지의 URL 얻기
			var target = $(this).find("option:selected").attr("data-target");
			var selector = "ajax/text/category-data.html " + target; // target = 카테고리 id
			// 다음 항목 로드
			$("#category3").load(selector, function() {
				$(this).show();
			});
		}); // on 2 end
		// 3depth에 대한 change 이벤트
		$(document).on("change", "#category3 > select", function() {
			// 선택항목이 존재할 경우 모든 드롭다운의 선택값 추출
			if ($(this).find("option:selected").index() > 0) {
				var data1 = $("#category1 > select > option:selected").val();
				var data2 = $("#category2 > select > option:selected").val();
				var data3 = $(this).find("option:selected").val();
				$(".console").html(data1 + " &gt; " + data2 + " &gt; " + data3);
			}
		}); // on 3 end
	}); // function end
</script>
</head>
<body>
	<h1 class="title">동적 드롭다운</h1>
	<div class="exec">
	<form>
	<!-- 각 단계별 dropdown을 표시할 span태그 -->
		<span id="category1"></span>
		<span id="category2"></span>
		<span id="category3"></span>
	</form>
	</div>
	<!-- 최종 선택 결과를 표시할 곳 -->
	<div class="console"></div>
</body>
</html>